
keymaps["base"].mydic = {
    "The Voice": {
        "color": 0,
        "created": "20241111",
        "definition": "",
        "midi": "17,17",
        "updated": "20241111",
        "img": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAWCAYAAAAhKqlXAAAAAXNSR0IArs4c6QAAAghJREFUaEPtWjFrwkAU/hIQLehikSr4B5yKi+DoXxDMH+hScHBx01E3KTj4JxJw6NSlOAoujnbpJFRBKhSkCIKWO+tp1MREPTXwsgTfnV/uvu/eu3cvUQAsQNdBBnQAua1eBgDt4D/ldFCYcIvFWrtGo4FisYhgMCieOB6PMRwO+e9oNIpwOCzaJpMJarUa8vm8sCkKg+XAwnYKbiaTQbfbhc/n43iz2QzJZBKtVkvga5oGwzCg6zpyuSXFo9HIdrxucPvpNOLttkmFV78fT6EQt23yYIdrx0MkEuFYbB5sPmwebD7bF+OXhHO4IEi4IzzZjWfI8rjf53vcPXybFv/Xh4rH92X0IY/7p8YpESsmZYdKEs6jHtd/SSP+s7XHffrx9EZ7nGXScwuhkoQjj7PM2imrlHAcOFfSQ8eBC5/jSDiPhkoSjoSjPe6SJS/PeJyqqqJKMJ1OTbXKQCAg2ubzuata5TG47DjQ6XRMVYtUKuW4Vmk13mvgrpKTfTycnFUOBgM0m030ej1ks1kkEgkUCgVOXL1e53bWzuysPRaLOSoyH4tbLpf5s6vVKr+XSiV+r1QqB4vMduO9Bi4TzoqHk4SzKyGt2pxUr1nfzbcDhGuu8e8r0bnhd+ftABF8XoJlLWASDsC+94e3voBJOBJuHWK8uIJlhTRZuORxXva4nY8ayHDzDPwBrQy/agLUfQUAAAAASUVORK5CYII="
    },
    "correct": {
        "color": 0,
        "created": "20250422",
        "definition": "correct",
        "midi": "18",
        "updated": "20250422",
        "img": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAWCAYAAAAhKqlXAAAAAXNSR0IArs4c6QAAAdNJREFUaEPtWjGOgkAUfZCYUFixMdEjUNJYbsIVTOQSbmJDp6V2NBYcQki8AsmWNpZ6A82ataIgMYHNTJYxKrIIy6KbT0P8o4+Z9/77MB8lADHouIuBFoCPlF+8AXDuQir+ZYkJF8cn7RzHgWVZaDabAvVwOGC32/HP7XYbqqqKsSAIYNs2BoOBiEkSg+XAIlYG1zAMrFYrNBoNjnc8HqHrOnzfF/imacLzPLiui36/z+P7/T5zvkVxPzcbvGjaFevvponX+RxZuFk8tFosJcDXwdbD1sHWc3kwfkm4AglBwuV0clFnkONyEpxY+r+XyjIJQaWyxnscCZfTyY9WKkk4Eo7fXZKndnqqrHg7QI4jx5Hj/nIDTo4jx5HjyHHfvUpZlkWLLAzDs16loihiLIqiu3qVRXDZdmC5XJ617Lrdbu5e5a351oGbbMDTeCj9VLndbrFYLLBer9Hr9aBpGobDISduNpvxOBtncTbe6XRyNZmL4o7HY37t6XTKz6PRiJ8nk8mPTeas+daBy4S7xUMp4RIm0kpPMpane335doBwz3v8Zfm9ejtABP8uwVUlMAkHIK0p/ugJTMKRcKcS84wZXFVJqwqXHPfMjrv6UwMFHp6BL0NEvGpoMZElAAAAAElFTkSuQmCC"
    },
    "error": {
        "created": 20240422,
        "definition": "not quite nice",
        "midi": "4",
        "img": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAWCAYAAAAhKqlXAAAAAXNSR0IArs4c6QAAAclJREFUaEPtWTGOgkAUfZiQUFiRmOgRLGnsvcAWJHgJChs7LaGjsbDcC2DCFextLDmCJiQ2WmhMZPNnFwwKLsKiuPnTIEx4M/P+/2+GpwQgRMFmAHBT3pUK4vFr+RkgjsMwvMRuNpthNBqh2WzGKNvtFpvNRty3222oqip+fxyP+NztbkaLAlcUlwD3+z0cx4Fpmuj3+1itVpBlWYx1Op2gaRoWi0U89mAwwHw+h+u6MAxKKSAIgsR864B7j99WqyXmTeug9dA6aD3XTZIkcOCenBAcOK44lspnSnAtKu56z4i0mDSYGu9xt3syB46lsrhUcsV9n64fOa1yxXHFccXx4eRHNvhwkm0YsFSyVLJU/iupbDQa8YnpcDgkvEpFUeK+8/kce4p5vuOK4JJXuVwuE5Zdr9fL7VVmzfcVuJFUpvFQ2qtcr9fwPA++70PXdXS7XQyHQ0HcdDoVz6mfnlN/p9MRZvBvgSuKO5lMBLRt2+I6Ho/F1bKseMwsk/nefF+BS4HL4qFU4CIm0oiI+vK419fOCeMmPf6y/N78O8AE/y3BVSUwBw5A2udL3ROYA8eBu0jMO2ZwVZJWFS5X3DtXXHI75rt3YOALQ67AahZfPtsAAAAASUVORK5CYII="
    },
    "good": {
        "created": 20240422,
        "definition": "quite nice",
        "midi": "7",
        "img": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAWCAYAAAAhKqlXAAAAAXNSR0IArs4c6QAAAd9JREFUaEPtWTuOwjAQfYmESAENEhI5AmUaei6wBRK5wJYUNHRQhi4NBSUXSCSKvQB9GkqOABISDRSgSLAa72IIn2z4eiNNmigeGNvv2W/GYw3ADgoeD0D9pF8fgK1gLGnsUiPidrsDd/1+H61WC7lcTs5nsVhgNpuJ71KphEKhIG2r1Qqu66LRaMg2TSO3wrFsO/U7WC7xsdlEMPvKZvGZz4u2Y7/VahXj8RiZTEbYwjCEZVkYjUby/7Ztw/d9eJ6Hev1nSczn89jxqvAbh2+xWBTjpnnQfGgeNJ/Th/Bl4t68IJg43nEsle+U4NTvONLtpLFTRSzax5Vnx04mjqVSjVTyjjvP2lORVTJxTJwIR8+ORRzjfhF45GDPyUn0CK70AM5SyVLJUkkI7CVN13W5P9frdaRWaRiGtG2325tqlff4JakMgiCiF5VKJXGt8tp4VfiNw/fhrHI6nWI4HGIymaBWq6FcLqPZbArger2eaCc7tZPdNM1EReZ7/XY6HdF3t9sV73a7Ld6O4/xZZI4brwq/RNw1HB4iLi6b2tuSVK/pt8e3A+w3mmBcyoJvwffsdoABfi7Ar1rATByAS/eH/30BM3FM3EFi0riCXyVpr/LLOy7NOy4ajvkrDQh8A3VExWoak7zvAAAAAElFTkSuQmCC"
    },
    "good voice": {
        "color": 0,
        "created": "20241108",
        "definition": "",
        "midi": "18,18",
        "updated": "20241111",
        "img": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAWCAYAAAAhKqlXAAAAAXNSR0IArs4c6QAAAfpJREFUaEPtWTFrwkAU/iIIDlmqCLp3yWgHl4LgXxDMn7Dgkk1H3VwcAp26qyD9B0KHDkKxmw6duhgq2sVBELTcQU5iYhovTY3wsgTf6efd++577947BcAe9JzlgSyAL49fPAAwz0KS/7LCiNvvD9yZpgnDMKCqqkBdrVawLIt/zuVySKfTYmy9XqPT6aBWqwmbojBYDixsYXDL5TImkwmSySTH2263KBQKGI1GAl/XdQwGA/T7fVSrVW5fLBa+85XFXc5myGiay+svuo5Srwc/XD8/ZLNsS4Cvg62HrYOt5/hh/iXiJDYEERdQybLKiEpx3++vuHm+dynhw7rD7eMbKc4OwXEjbvk5Q+bJI1SqOkoGhUqRO4k4p7gpx0keekhxV5rjwuROOlVesBwg4khxPHnZdTLVcREX4KQ4Uhwp7j9bXrFWXCKREMXDZrNx9CpTqZQY2+12Z/UqZXBZHTcejx3FTLFYDNyrPDXfS+Dap0ovP4TOcfP5HMPhENPpFJVKBZqmoV6vc8d1u11uZ+PMzsbz+XygJrMsbrPZ5P/dbrf5u9Fo8Her1fq1yew330vgMuJO+SEUcbYnvEKPPRake318O0C4zu5HWP+6bgfIwX/r4Kg2MBEHwOv+MO4bmIgj4g4h5hp3cFQhLSpcUtw1K851lUuG2HvgB8c5tGrZIDqNAAAAAElFTkSuQmCC"
    },
    "incorrect": {
        "color": 0,
        "created": "20250422",
        "definition": "incorrect",
        "midi": "16",
        "updated": "20250422",
        "img": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAWCAYAAAAhKqlXAAAAAXNSR0IArs4c6QAAAcJJREFUaEPtWruKwkAUPRGEFFZCQD/B0kawzC8EzE9YCIudltoJi4U/kUB+wVKwsfQTFCKpLARBlzus4yu6rjHqLidN8A6c3Dk3587kjAaALXgpBuKIcAH4b8iPIflut/uUB4MBms0mcrmcTjeKIsznc/W7UCggn8/rseVyiV6vh3q9rmOGIbAKWMeS4Nq2jclkgmw2q/DW6zXK5TKGw6HGd10Xvu/D8zzUajUVD8Pwar6nuOFicVaiz2oVH6NRItzDfK/xYFmWer7MQ+Yj85D5nF7CLwt38EKwcFTcxQ5BxbFVco1Le+3kGpfy5iStTQ8Lx8KpDSZ3lU/6zKDiqDgqTgyDZ33YU3FUHBX3bxWXyWS0RbZarY68StM09dhms/mVV3kPrrS08Xh8ZNlVKpWbvcpL+b4Cd+ecxPGQ2KuczWYIggDT6RSO46BUKqHRaCji+v2+isu4xGW8WCzeZDLfi9tut9Wzu92uurdaLXXvdDo/mszX8n0FrhTuEg+JCrdjIs5t343d4l6fng4Q99jjT8rv2ekACX4swWm9wCzctxORFsFp4bJwLNy+xcSdgLMFP7YFU3F/WXFnf2pg4O0Z+AL+LLlqZgnLBAAAAABJRU5ErkJggg=="
    },
    "ok": {
        "created": 20240422,
        "definition": "not bad",
        "midi": "6",
        "img": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAWCAYAAAAhKqlXAAAAAXNSR0IArs4c6QAAAchJREFUaEPtWr2KwkAQ/iIELKwUD/MIlmksD3wFQX0IizR2sYxdGuF8iQi+QuBKG8s8gkI4K4uAEI9ZSST+xGAuazxmm5Bd8u3s9+2MO7MqAI6Q0EYAvm7M8wHAlzD/f5tCIeGOx7N28/kc4/EYtVotXutut8N2uxXvrVYL9Xo9Htvv97BtG6MRSXNqikKwAjju+x4O8ek4V/z9eB7CRiMVt9vtYr1eQ1VV8f3hcICu63BdN8YbDAZYLBZwHAf9fl/0+75fOtw0fpvNprCb1kHroXXQei4b8cvCSd4QLBx7nJxQmScEc6hMBkupoZKFO/0mv12oZOFYOD5VyjxVssexx7HHscfJT+z5cMJ5HOdxMktphXtcpVKJs74gCBK1ymq1Go+FYZipVhkZ/AwuJeCr1SqRhXY6ncy1ynv2vgI3jYfctcrNZoPlcgnP89Dr9dBut2EYhiBuNpuJfhqnfhrXNO1hkZkMfhZ3MpmIuafTqXiapimelmU9LDKn2fsK3DQecgkXMXGr2h6NZaleX94OMG6ybJWX36vbASb4bwkuagOzcHfuD8u+gVk4Fu4cYm7dgJd9BxcV0orCZY97Z4+7+lMDd5SegV+B5L9qmwD9jQAAAABJRU5ErkJggg=="
    },
    "well done": {
        "color": 0,
        "created": "20250422",
        "definition": "well done",
        "midi": "19",
        "updated": "20250422",
        "img": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAWCAYAAAAhKqlXAAAAAXNSR0IArs4c6QAAAclJREFUaEPtWTGOgkAUfZiQWFgZSfAIljb2XmALEr0EhY0dltrZWFjuBSDhCvQ2lB5BExMaLTQmsPmzEWVFVmVQST4NYQYeM+/Nnz/zRgEQga9cDPQA2CkISi7U7I8JO4qis3bz+RzD4RC1Wi3+MggCrNdr8azrOur1ely32+0wnU5hmmZcpii/TZaF2+124fs+VFUVuMfjEe12G57nxf/s9/twHAe2baPXIyqBzWaT2V5ZuF+HA7632yumtUbjqr1Z/GqaJt6nflB/qB/Un78X8cvCSRgQLNyNSJYVGTRyL2cIWbgsHAvHU+Urc9wjkcw57oMWJyxcSadKFo6F4xzHOQ4Ab8Dlbex5ccKLE7a8XmmlFR5xlUoltsj2+33Cq6xWq3FdGIYPeZXP4JLDsVgsEpZdp9O526u81d534J6ES+Mht1e5Wq3gui6WyyUMw0Cr1cJgMBDEzWYzUU71VE71zWbzLpP5WdzRaCT+PZlMxN2yLHEfj8f/msxZ7X0HLgl3i4dcwp2YSHPbT3X3uNf07uXpAOMmPf68/F6dDjDBcgkuagCzcADSzg8/fQCzcCzceYop4wguakorCpcjrswRl0zH/FQGBn4AU/60aoxcoHYAAAAASUVORK5CYII="
    }
};


keymaps["base"].funcdict = {};
//this.keydict[ "" ] = {"1": { "4": "error", "6": "ok", "7": "good"} };
//this is loaded from dictionary.  

keymaps["base"].funcdict["updateState"] = function(transcript, midi, keydict, key){
}

keymaps["base"].funcdict[""] = function(transcript, midi, keydict, key){
    for (i=MAX_COMMANDLENGTH; i>0; i--){
        if (midi != null && midi.length >=i){
            let keyset = keydict[""][i.toString()];
            let keys = "";

            if (typeof(keyset) !=="undefined"){
                for (j=0; j<i; j++){
                    keys += (midi[j].note - keybot["base"]).toString();
    //                        keys += midi[j].note.toString();
                    if (j<i-1){
                        keys += ",";
                    }
                }
                if (typeof(keyset[keys]) !=="undefined" && keyset[keys] != null){
                    //run this function.  
                    transcript += keyset[keys];
                    for (j=0; j<i; j++){
                        midi[j].complete = true;
                    }

                    //add prefix here if needed.  
                    if (keymaps["base"].currentprefix != ""){
                        transcript = keymaps["base"].currentprefix + " " + transcript;
                    }
                    return transcript;
                }
            }
        }
    }
    return transcript;
};


//not sure if we want to do this here or from word definitions.  Maybe easier to just specify here.  
keymaps["base"].keydict[""] ["3"] = {
    "12,13,13": "content",
    "12,14,14": "transcription"
};

keymaps["base"].currentprefix = "";

keymaps["base"].funcdict["content"] = function(transcript, midi, keydict, key){
    keymaps["base"].currentprefix = "content";
};

keymaps["base"].funcdict["transcription"] = function(transcript, midi, keydict, key){  
  keymaps["base"].currentprefix = "transcription";
}


keymaps["base"].keydict[ "" ] ["4"] = {"24,21,23,24": "skip " };

keymaps["base"].keydict["skip "] = {"1": {"min": -12, "max": 12}}; //number of increments.  from middle C

keymaps["base"].funcdict["skip "] = function(transcript, midi, keydict, key){
    let commandlength = null;
    let commanddict = null;
    for (const [k, v] of Object.entries(keydict[key])) {
        if (parseInt(k) <= midi.length){
            commandlength = k;
            commanddict = v;
        };
    }
    //maybe not for all commands, but here, we set to blank in case we have incorrect params.  
    transcript = "";
    let skip = 0;
    if (commandlength !== null){
        //we have a command map at least.  
        if (commandlength == "1"){
            skip = midi[0].note - keybot["base"] - OCTAVE;
            if (skip > -OCTAVE-1 && skip < OCTAVE+1){

                skip = Math.sign(skip)*Math.pow(3, (Math.abs(skip)));
                transcript = "skip " + skip.toFixed(2);
                midi[0].complete = true;
                //I think this will work ok.  
                //this allows us to move on to next command.  
            }
            else{
                //not sure how I want to handle errors yet.  
                return "ERROR skip - incorrect parameters"
            }
        }

    }
    return transcript; //add language xxxx 2,3,4
};
